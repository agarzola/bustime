{
  "name": "bustime",
  "tagline": "An abstraction of the Clever Devices BusTime developer API",
  "body": "bustime\r\n============\r\n\r\nAn abstraction of the Clever Devices [BusTime API](http://bustracker.gocarta.org/bustime/apidoc/v1/DeveloperAPIGuide.pdf), used by transit authorities across the U.S. `bustime` takes parameter values as a JavaScript object and returns the API’s response also as an object. You need not worry about generating query parameters or parsing XML responses! Yay!\r\n\r\nNow with [utility methods](#utility-methods) to help you mine data from your API!\r\n\r\n**::::::::::::::: Probably not production ready! (But it’s close!) :::::::::::::::**\r\n\r\n\r\nContents\r\n============\r\n\r\n* [Installation](#installation)\r\n* [Usage](#usage)\r\n* [Request methods](#request-methods)\r\n    * [1. Endpoint-specific methods](#request-methods-1-endpoint-specific-methods)\r\n        * [.time(reqObj, callback)](#request-methods-1-endpoint-specific-methods--time-reqobj-callback-)\r\n        * [.vehicles(reqObj, callback)](#request-methods-1-endpoint-specific-methods--vehicles-reqobj-callback-)\r\n        * [.routes(reqObj, callback)](#request-methods-1-endpoint-specific-methods--routes-reqobj-callback-)\r\n        * [.directions(reqObj, callback)](#request-methods-1-endpoint-specific-methods--directions-reqobj-callback-)\r\n        * [.stops(reqObj, callback)](#request-methods-1-endpoint-specific-methods--stops-reqobj-callback-)\r\n        * [.patterns(reqObj, callback)](#request-methods-1-endpoint-specific-methods--patterns-reqobj-callback-)\r\n        * [.predictions(reqObj, callback)](#request-methods-1-endpoint-specific-methods--predictions-reqobj-callback-)\r\n        * [.serviceBulletins(reqObj, callback)](#request-methods-1-endpoint-specific-methods--servicebulletins-reqobj-callback-)\r\n    * [2. Generic request method](#request-methods-2-generic-request-method)\r\n        * [.request(requestType, reqObj, callback)](#request-methods-2-generic-request-method--request-requesttype-reqobj-callback-)\r\n* [Utility methods](#utility-methods)\r\n    * [.collectRoutesAndStops(callback[, config])](#utility-methods--collectroutesandstops-callback-config-)\r\n* [What about the browser?](#what-about-the-browser-)\r\n\r\n\r\n---\r\n\r\n<h2 id=\"installation\">Installation</h2>\r\n```bash\r\n$ npm install bustime\r\n```\r\n_(You probably want to `--save` it as a dependency, but I ain’t the boss of you.)_\r\n\r\n\r\n<h2 id=\"usage\">Usage</h2>\r\nBefore you require `bustime`, you should create an object with at least your API key and the host. This object is then passed as an argument of require, like so:\r\n```javascript\r\nvar bustime = require('bustime');\r\n\r\nvar apiObj = {\r\n    key: 'your_api_key',       // required\r\n    host: 'your_api_host.com', // required\r\n    localestring: 'lang',      // optional, default is whatever the BusTime ↵\r\n                               // API you’re accessing is set to\r\n    port: 80,                  // optional, default is 80\r\n    path: '/path/to/api'       // optional, default is '/bustime/api/v1'\r\n}\r\n\r\nvar bustime = require('bustime')(apiObj);\r\n```\r\n\r\n\r\n<h2 id=\"request-methods\">Request methods</h2>\r\nThere are two ways to make requests to the API using this library:\r\n\r\n1. **Using an endpoint-specific method:** This is the preferred way if you’d like to use the added services that `bustime` offers for each. For example, all endpoint-specific methods validate your request parameter object by default according to the needs of that endpoint, to avoid faulty requests made to the API (this can be turned off by on a per-method basis). Additionally, some of the methods offer special services that you can choose to turn on.\r\n2. **Using the generic `.request()` method:** This method makes a request to the API and converts the XML response into a JavaScript object. It offers nothing more than that. This is the method that each of the dedicated methods described above use to make requests between validating and performing additional services on the resulting data.\r\n\r\n\r\n---\r\n\r\n<h3 id=\"request-methods-1-endpoint-specific-methods\">1. Endpoint-specific methods</h3>\r\nBelow are the methods dedicated to specific endpoints on the BusTime API. Each has its own request object requirements. This object (sans the `services` property pertaining to `bustime`’s services) is translated directly to the querystring in the request to the API. See the [BusTime Developer API Guide](http://bustracker.gocarta.org/bustime/apidoc/v1/DeveloperAPIGuide.pdf) for more information on each parameter.\r\n\r\n**A note on validation:** Each endpoint-specific method below validates your `reqObj` object by default. When your object fails validation, an error is returned to your callback and the request to the BusTime API is aborted. To turn off validation (not that you’d ever want to), include a `validate` property set to `false` within the `services` property of your request object, like so:\r\n```javascript\r\nvar reqObj = {\r\n  // ... your other properties ... //\r\n  services: {\r\n    validate: false\r\n  }\r\n}\r\n```\r\n\r\nI’ve omitted the `validate` property from the descriptions below for the sake of being succinct. Just know that it’s available in each of these endpoint-specific methods.\r\n\r\n---\r\n\r\n<h4 id=\"request-methods-1-endpoint-specific-methods--time-reqobj-callback-\">.time(reqObj, callback)</h4>\r\n```javascript\r\nvar reqObj = {\r\n  services: {\r\n    moment: true // optional\r\n  }\r\n}\r\n\r\nbustime.time(reqObj, function (err, result) {\r\n    console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\n\r\nServices available:\r\n- `moment`: Boolean, defaults to false. If true, includes the time as a [moment.js](http://momentjs.com/) object in `result.moment`.\r\n\r\n`result` is an object with a `tm` property containing the API’s time in YYYYMMDD HH:MM:SS format, and an `error` property containing an array of errors. Like so:\r\n\r\n```javascript\r\n{ tm: '20141127 10:07:30',\r\n  moment:\r\n   { _isAMomentObject: true,\r\n     _i: '20141127 10:07:30',\r\n     _f: 'YYYYMMDD HH:mm:ss',\r\n     _isUTC: false,\r\n     _pf:\r\n      { empty: false,\r\n        unusedTokens: [],\r\n        unusedInput: [],\r\n        overflow: -1,\r\n        charsLeftOver: 0,\r\n        nullInput: false,\r\n        invalidMonth: null,\r\n        invalidFormat: false,\r\n        userInvalidated: false,\r\n        iso: false },\r\n     _locale:\r\n      { _ordinalParse: /\\d{1,2}(th|st|nd|rd)/,\r\n        ordinal: [Function],\r\n        _abbr: 'en',\r\n        _ordinalParseLenient: /\\d{1,2}(th|st|nd|rd)|\\d{1,2}/ },\r\n     _d: Thu Nov 27 2014 10:07:30 GMT-0500 (EST) } }\r\n```\r\n\r\n---\r\n<h4 id=\"request-methods-1-endpoint-specific-methods--vehicles-reqobj-callback-\">.vehicles(reqObj, callback)</h4>\r\n```javascript\r\nvar reqObj = {\r\n  rt: route_number, // optional, not available w/vid\r\n  vid: vehicle_id,  // optional, not available w/rt\r\n  tmres: resolution // optional, defaults to 'm'\r\n}\r\n\r\nbustime.vehicles(reqObj, function (err, result) {\r\n    console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\nWhere `result` is an object with a `vehicle` property containing an array of vehicle objects, and an `error` property containing an array of error objects.\r\n\r\nRequest object properties are:\r\n- `rt`: route number(s). Can be an Integer or String. May include multiple, comma-delimited route numbers as a string (e.g. `'4,9'`)\r\n- `vid`: vehicle ID(s). Can be an Integer or String. May include multiple, comma-delimited route numbers as a string (e.g. `'128,506'`)\r\n- `tmres`: time stamp resolution. Set to `'s'` to get time resolution to the second. Set to `'m'` to get time resolution to the minute. Defaults to `'m'`.\r\n\r\n---\r\n<h4 id=\"request-methods-1-endpoint-specific-methods--routes-reqobj-callback-\">.routes(reqObj, callback)</h4>\r\n```javascript\r\nbustime.routes(null, function (err, result) {\r\n    console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\nWhere `result` is an object with a `route` property containing an array of route objects, and an `error` property containing an array of error objects.\r\n\r\n---\r\n<h4 id=\"request-methods-1-endpoint-specific-methods--directions-reqobj-callback-\">.directions(reqObj, callback)</h4>\r\n```javascript\r\nvar reqObj = {\r\n  rt: route_number // required\r\n}\r\n\r\nbustime.directions(reqObj, function (err, result) {\r\n    console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\nWhere `result` is an object with a `dir` property containing an array of route direction strings, and an `error` property containing an array of error objects.\r\n\r\nRequest object properties are:\r\n\r\n- `rt`: route number(s). Can be an Integer or String. May only be one route number.\r\n\r\n---\r\n<h4 id=\"request-methods-1-endpoint-specific-methods--stops-reqobj-callback-\">.stops(reqObj, callback)</h4>\r\n```javascript\r\nvar reqObj = {\r\n  rt: route_number, // required\r\n  dir: direction    // required\r\n}\r\n\r\nbustime.stops(reqObj, function (err, result) {\r\n    console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\nWhere `result` is an object with a `stop` property containing an array of stop objects, and an `error` property containing an array of error objects.\r\n\r\nRequest object properties are:\r\n\r\n- `rt`: route number(s). Can be an Integer or String. May include multiple, comma-delimited route numbers as a string (e.g. `'33,34'`)\r\n- `dir`: direction(s). Can be an Integer or String. May include multiple, comma-delimited route numbers as a string (e.g. `'0,1'`)\r\n\r\n---\r\n<h4 id=\"request-methods-1-endpoint-specific-methods--patterns-reqobj-callback-\">.patterns(reqObj, callback)</h4>\r\n```javascript\r\nvar reqObj = {\r\n  rt: route_number, // optional, not available w/pid\r\n  pid: direction    // optional, not available w/rt\r\n}\r\n\r\nbustime.patterns(reqObj, function (err, result) {\r\n    console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\nWhere `result` is an object with a `ptr` property containing an array of pattern objects, and an `error` property containing an array of error objects.\r\n\r\nRequest object properties are:\r\n\r\n- `rt`: route number(s). Can be an Integer or String. May include multiple, comma-delimited route numbers as a string (e.g. `'33,34'`)\r\n- `pid`: pattern ID(s). Can be an Integer or String. May include multiple, comma-delimited pattern ID numbers as a string (e.g. `'897,899'`)\r\n\r\n---\r\n<h4 id=\"request-methods-1-endpoint-specific-methods--predictions-reqobj-callback-\">.predictions(reqObj, callback)</h4>\r\n```javascript\r\nvar reqObj = {\r\n  stpid: stop_id,       // optional, not available w/vid\r\n  rt: route_number,     // optional, requires stpid\r\n  vid: vehicle_id,      // optional, not available w/stpid\r\n  top: max_predictions, // optional, max number of predictions\r\n  tmres: resolution     // optional, defaults to 'm'\r\n  services: {\r\n    calculateETA: true  // optional, defaults to false\r\n  }\r\n}\r\n\r\nbustime.predictions(reqObj, function (err, result) {\r\n    console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\nWhere `result` is an object with a `prd` property containing an array of prediction objects, and an `error` property containing an array of error objects. It may contain both properties, particularly when multiple routes or stops are sent in the query.\r\n\r\nRequest object properties are:\r\n- `stpid`: stop ID(s). Can be an Integer or String. May include multiple, comma-delimited stop numbers as a string (e.g. `'897,899'`)\r\n- `rt`: route number(s). Can be an Integer or String. May include multiple, comma-delimited route numbers as a string (e.g. `'33,34'`)\r\n- `vid`: vehicle ID(s). Can be an Integer or String. May include multiple, comma-delimited vehicle numbers as a string (e.g. `'452,191'`)\r\n- `top`: max number of predictions. Must be an Integer\r\n- `tmres`: time stamp resolution. Set to `'s'` to get time resolution to the second. Set to `'m'` to get time resolution to the minute. Defaults to `'m'`. _(This option is not documented in the BusTime documentation for the `/getpredictions` endpoint, but seems to work anyway.)_\r\n\r\nServices available:\r\n- `calculateETA`: Boolean, defaults to false. If true, calculates the estimated time of arrival of each prediction in milliseconds and includes it in that prediction’s `eta` property. _(This option works best when `tmres` is set to `'s'`.)_\r\n\r\n---\r\n<h4 id=\"request-methods-1-endpoint-specific-methods--servicebulletins-reqobj-callback-\">.serviceBulletins(reqObj, callback)</h4>\r\n```javascript\r\nvar reqObj = {\r\n  rt: route_number,     // required if stpid not specified\r\n  rtdir: route_dir,     // optional, requires rt property\r\n  stpid: stop_id        // required if rt not specified\r\n}\r\n\r\nbustime.serviceBulletins(reqObj, function (err, result) {\r\n  console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\nWhere `result` is an object with a `sb` property containing an array of bulletin objects, and an `error` property containing an array of error objects.\r\n\r\n\r\n---\r\n\r\n<h3 id=\"request-methods-2-generic-request-method\">2. Generic request method</h3>\r\nThe generic request method offers a barebones API request and no special services. It is up to you to set the request type as a string in the first argument. Like the endpoint-specific methods, it responds with a JavaScript object.\r\n\r\nThe generic `.request()` method might come in handy if you write your own BusTime-related methods and want to make them available for more than one API request type (as opposed to limiting your method to, for example, only _predictions_ or only _stops_, for example). It could also be useful if a future version of BusTime adds endpoints that this library doesn’t yet cover.\r\n\r\n<h4 id=\"request-methods-2-generic-request-method--request-requesttype-reqobj-callback-\">.request(requestType, reqObj, callback)</h4>\r\n```javascript\r\nvar reqObj = {}; // The contents of this object will depend on the type ↵\r\n                 // of request you’ll be making to the BusTime API.\r\n\r\nvar requestType = 'getpredictions'; // requires one of the BusTime request types\r\n\r\nbustime.request(requestType, reqObj, function (err, result) {\r\n  console.log(JSON.stringify(result, null, 2));\r\n});\r\n```\r\nWhere `result` is an object like the one you would get from any of the endpoint-specific methods described above.\r\n\r\nOptions for `requestType` are: `'gettime'`, `'getvehicles'`, `'getroutes'`, `'getdirections'`, `'getstops'`, `'getpatterns'`, `'getpredictions'`, `'getservicebulletins'`.\r\n\r\n\r\n---\r\n\r\n<h2 id=\"utility-methods\">Utility methods</h2>\r\n`bustime` also offers a method for collecting data from the BusTracker API to store in memory or commit to a file for later use in your app. There is only one such method at the moment, but more may be added in the future. [Open an issue](https://github.com/agarzola/bustime/issues) if there’s a specific utility you’d like to see implemented.\r\n\r\n\r\n<h3 id=\"utility-methods--collectroutesandstops-callback-config-\">.collectRoutesAndStops(callback[, config])</h3>\r\nThis method builds a comprehensive object which includes all available routes, their directions, and every stop served by each direction in each route. This can be useful if your application needs to check whether a specific stop (or group thereof) is served by a route, or rule out a stop depending on which direction a bus is going. All information associated with routes and stops is included and left intact to make the object as useful as possible.\r\n\r\nBy default, this method provides an array of route objects. That array looks like this:\r\n\r\n```javascript\r\n[\r\n  { rt: '1',\r\n    rtnm: '1 ALTON PARK',\r\n    rtclr: '#cc3399',\r\n    dir: [\r\n      { id: '0',\r\n        stops: [\r\n          { stpid: '1581',\r\n            stpnm: '33RD + CHATTEM',\r\n            lat: '35.017467535463',\r\n            lon: '-85.321669578552'\r\n          },\r\n          { ... }\r\n        ]\r\n      },\r\n      { id: '1',\r\n        stops: [\r\n          { ... },\r\n          { ... }\r\n        ]\r\n      }\r\n    ]\r\n  },\r\n  {\r\n    rt: '2',\r\n    ...\r\n  }\r\n]\r\n```\r\n\r\nThe direction `id` is set to whatever is returned by your BusTracker API. It can be a number, but also something like `'Inbound'`. This depends on how your BusTracker API is set up to identify route directions.\r\n\r\nAlternatively, you could pass a config object as a second argument setting the format to 'object'. This config argument and the resulting object look like this:\r\n\r\n``` javascript\r\nvar config = {\r\n  format: 'object'\r\n}\r\n\r\n// Produces a slightly different object:\r\n{\r\n  '1': {\r\n    rt: '1',\r\n    rtnm: '1 ALTON PARK',\r\n    rtclr: '#cc3399',\r\n    dir: [ \r\n      { ... },\r\n      { ... }\r\n    ]\r\n  }\r\n}\r\n```\r\nNote the `key:value` pairs, making it easy to reference a specific route’s data by using the route number as the key. Other than this one feature, each route’s object is identical to the ones in the array format. This formatting option just gives you a different way of referencing the resulting object.\r\n\r\n**Please note:** In either case, this operation can take a while to complete (up to a few seconds, depending on your API server’s load), so it’s recommended that you run this once while booting up your app (to store in memory) or as part of a data collection script (from which you can commit it to a text file or database for later consumption). Otherwise, you risk performance issues in your application.\r\n\r\n\r\n---\r\n\r\n<h2 id=\"what-about-the-browser-\">What about the browser?</h2>\r\nI’ll be working on making this work in the browser as well. No idea when, though. For the time being, [browserify](http://browserify.org/) might do the trick (untested). Pull requests are welcome!\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}